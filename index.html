<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flashino</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1d59ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="assets/flashino-icon-192.png">

  <style>
    :root{
      --brand:#1d59ff;
      --brand2:#2e84ff;
      --bg:#0b0f1a;
      --card:#0e1424;
      --text:#edf2ff;
      --muted:#9fb0d8;
      --ok:#2ecc71;
      --radius:16px;
    }
    html,body{height:100%;margin:0;background:radial-gradient(1000px 700px at 20% -10%, #183a8a55 0%, transparent 60%), var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{min-height:100%;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:640px;background:linear-gradient(180deg,#0e1528,#0a1020);border:1px solid #1b2750;border-radius:var(--radius);box-shadow:0 40px 80px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.05);overflow:hidden}
    .hero{padding:28px 24px 12px;text-align:center}
    .logo{width:96px;height:96px;border-radius:24px;display:inline-grid;place-items:center;margin:0 auto 14px;background:linear-gradient(145deg,var(--brand),var(--brand2));box-shadow:0 12px 30px rgba(29,89,255,.45)}
    .logo img{width:78px;height:78px;object-fit:contain;filter: drop-shadow(0 2px 8px rgba(0,0,0,.4));}
    h1{font-size:28px;margin:8px 0 4px;letter-spacing:.2px}
    .tagline{font-size:15px;color:var(--muted);margin-bottom:16px}
    .chip{display:inline-flex;align-items:center;gap:8px;background:#0f1b33;border:1px solid #1d2a44;color:#c7d2fe;padding:8px 12px;border-radius:999px;font-size:13px;margin-top:8px}
    .content{padding:12px 24px 24px}
    label{display:block;font-size:14px;color:var(--muted);margin-bottom:8px}
    .input-row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;background:#0e1525;border:1px solid #1d2a44;padding:10px;border-radius:12px}
    input[type="text"]{background:transparent;border:none;outline:none;color:var(--text);font-size:16px;padding:10px}
    .btn{background:var(--brand);color:#fff;border:none;padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 8px 18px rgba(29,89,255,.35);transition:transform .06s ease, box-shadow .2s ease}
    .btn:active{transform:translateY(1px);box-shadow:0 6px 12px rgba(29,89,255,.3)}
    .btn.secondary{background:#1f2937;box-shadow:none}
    .notice{margin-top:14px;font-size:14px;color:var(--muted);display:none}
    .notice.inline{display:block}
    .divider{height:1px;background:#15213a;margin:20px 0}
    .frame-wrap{display:none;border-top:1px solid #1f2a44;background:#0a0f1d}
    .toolbar{display:flex;gap:8px;align-items:center;padding:10px 12px;background:#0d1426;border-bottom:1px solid #1f2a44}
    .toolbar .url{flex:1;background:#0e1525;border:1px solid #1d2a44;color:#9ca3af;padding:8px 10px;border-radius:10px;font-size:13px;overflow:hidden;text-overflow:ellipsis}
    iframe{width:100%;height:calc(100dvh - 360px);border:none;background:#0a0f1d}
    .foot{padding:16px 24px 22px;color:#8aa4ff;font-size:13px}
    .error{color:#fda4af;margin-top:8px;font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hero">
        <div class="logo">
          <img src="assets/flashino-logo.png" alt="Flashino Logo">
        </div>
        <h1>Herzlich willkommen bei Flashino</h1>
        <div class="tagline" id="tagline">Lerne. Flashe. Fertig!</div>
        <div class="chip" id="pwaStateChip">Status: Browser</div>
      </div>

      <div class="content">
        <label for="ip">Bitte gib die IP-Adresse ein, die an der Tafel angezeigt wird:</label>
        <div class="input-row">
          <input id="ip" type="text" inputmode="decimal" placeholder="z. B. 192.168.0.42:8080" autocomplete="off" />
          <button class="btn" id="openBtn">Weiter</button>
        </div>
        <div class="error" id="error"></div>

        <div class="notice inline" id="installNotice">
          Nicht als Web App installiert. Tippe auf „Teilen“ und dann „Zum Home‑Bildschirm hinzufügen“, um Flashino als Web App zu nutzen.
        </div>
        <div class="notice" id="installedNotice">
          Flashino läuft als Web App. Du kannst diese Seite direkt über das Icon auf dem Home‑Bildschirm starten.
        </div>

        <div class="divider"></div>

        <div class="notice inline" id="howTo">
          Hinweis: Wenn du die IP eingegeben hast, öffnet sich die Seite innerhalb dieser App (nicht in Safari).
        </div>
      </div>

      <div class="frame-wrap" id="frameWrap">
        <div class="toolbar">
          <div class="url" id="urlBar">about:blank</div>
          <button class="btn secondary" id="backBtn">Zurück</button>
          <button class="btn secondary" id="reloadBtn">Neu laden</button>
        </div>
        <iframe id="frame" sandbox="allow-forms allow-scripts allow-same-origin"></iframe>
      </div>

      <div class="foot">
        Made with ❤️ für Schüler • Flashino
      </div>
    </div>
  </div>

  <script>
    // Optional: Slogan hier direkt ändern
    // document.getElementById('tagline').textContent = 'Dein Slogan hier';

    // PWA-Detection
    function isStandalone() {
      return window.matchMedia('(display-mode: standalone)').matches
          || window.navigator.standalone === true;
    }
    function updateInstallUI() {
      const chip = document.getElementById('pwaStateChip');
      const installNotice = document.getElementById('installNotice');
      const installedNotice = document.getElementById('installedNotice');
      if (isStandalone()) {
        chip.textContent = 'Status: Web App';
        chip.style.color = '#bbf7d0';
        chip.style.borderColor = '#17432b';
        chip.style.background = '#0b2a1a';
        installNotice.style.display = 'none';
        installedNotice.style.display = 'block';
      } else {
        chip.textContent = 'Status: Browser';
        installNotice.style.display = 'block';
        installedNotice.style.display = 'none';
      }
    }
    updateInstallUI();
    window.matchMedia('(display-mode: standalone)').addEventListener('change', updateInstallUI);

    // Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }

    // IP öffnen innerhalb der App
    const ipInput = document.getElementById('ip');
    const openBtn = document.getElementById('openBtn');
    const errorEl = document.getElementById('error');
    const frameWrap = document.getElementById('frameWrap');
    const frame = document.getElementById('frame');
    const urlBar = document.getElementById('urlBar');
    const backBtn = document.getElementById('backBtn');
    const reloadBtn = document.getElementById('reloadBtn');

    function normalizeUrl(input) {
      let value = input.trim();
      if (!value) return null;
      if (!/^https?:\/\//i.test(value)) value = 'http://' + value;
      try {
        const url = new URL(value);
        const host = url.hostname;
        const isIPv4 = /^(\d{1,3}\.){3}\d{1,3}$/.test(host);
        const isIPv6 = /^\[?[0-9a-fA-F:]+\]?$/.test(host);
        const isLocalName = /^(localhost|flashino|[a-z0-9-]+\.local)$/i.test(host);
        if (!(isIPv4 || isIPv6 || isLocalName)) return null;
        return url.toString();
      } catch { return null; }
    }

    function openInsideApp(url) {
      frameWrap.style.display = 'block';
      frame.src = url;
      urlBar.textContent = url;
      errorEl.textContent = '';
    }

    openBtn.addEventListener('click', () => {
      const normalized = normalizeUrl(ipInput.value);
      if (!normalized) {
        errorEl.textContent = 'Bitte eine gültige IP-Adresse oder lokale URL eingeben (z. B. 192.168.0.42:8080).';
        return;
      }
      openInsideApp(normalized);
    });

    ipInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') openBtn.click(); });
    backBtn.addEventListener('click', () => { frameWrap.style.display = 'none'; frame.src = 'about:blank'; });
    reloadBtn.addEventListener('click', () => { if (frame.src && frame.src !== 'about:blank') frame.contentWindow?.location?.reload?.(); });

    // iOS: Install-Hinweis
    const ua = navigator.userAgent.toLowerCase();
    if (/iphone|ipad|ipod/.test(ua) && !isStandalone()) {
      document.getElementById('howTo').textContent = 'iOS: Tippe unten auf „Teilen“ → „Zum Home‑Bildschirm“.';
    }
  </script>
</body>
</html>
